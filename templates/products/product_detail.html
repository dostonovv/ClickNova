{% extends "core/base.html" %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
  <div class="grid lg:grid-cols-2 gap-8 lg:gap-16">
    <!-- Gallery ‚Äî Chap taraf (mobil da yuqorida) -->
    <div class="order-2 lg:order-1">
      <!-- Asosiy rasm ‚Äî kattaroq va premium -->
      <div class="mb-6 rounded-3xl shadow-2xl overflow-hidden bg-gray-50 border-2 border-gray-100">
        <img id="mainImage"
             src="{% if product.images.all %}
                    {% with product.images.filter(is_main=True).first|default:product.images.first as main_img %}
                      {{ main_img.image.url }}
                    {% endwith %}
                  {% else %}
                    https://via.placeholder.com/1000x1000?text=No+Image
                  {% endif %}"
             alt="{{ product.name }}"
             class="w-full h-96 sm:h-full object-cover transition-all duration-700 hover:scale-105 cursor-zoom-in">
      </div>

      <!-- Thumbnail rasmlar ‚Äî chiroyli grid -->
      {% if product.images.count > 1 %}
      <div class="grid grid-cols-4 sm:grid-cols-5 gap-3 sm:gap-4">
        {% for img in product.images.all %}
        <div class="rounded-2xl shadow-lg overflow-hidden cursor-pointer border-4 transition-all duration-300 {% if img.is_main %}border-emerald-500 ring-4 ring-emerald-300{% else %}border-gray-200 hover:border-emerald-400{% endif %}"
             onclick="document.getElementById('mainImage').src='{{ img.image.url }}'">
          <img src="{{ img.image.url }}"
               alt="{{ img.alt_text|default:product.name }}"
               class="w-full h-24 sm:h-32 object-cover hover:opacity-90 transition">
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Ma‚Äôlumotlar ‚Äî O‚Äòng taraf (mobil da pastda) -->
    <div class="order-1 lg:order-2">
      <div class="flex flex-col justify-between h-full">
        <div>
          <!-- Kategoriya -->
          {% if product.category %}
          <a href="#" class="inline-block bg-emerald-100 text-emerald-800 px-5 py-2 rounded-full text-sm sm:text-base font-semibold mb-6 hover:bg-emerald-200 transition">
            {{ product.category.name }}
          </a>
          {% endif %}

          <!-- Nomi -->
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-gray-900 mb-6 leading-tight">
            {{ product.name }}
          </h1>

          <!-- Narx ‚Äî juda ta‚Äôsirli -->
          <div class="mb-10 flex flex-wrap items-end gap-4">
            {% if product.discount_percent > 0 %}
            <span class="text-2xl sm:text-3xl text-gray-500 line-through">${{ product.price|floatformat:2 }}</span>
            <span class="text-5xl sm:text-6xl lg:text-7xl font-extrabold text-emerald-600">${{ product.get_discounted_price|floatformat:2 }}</span>
            <div class="bg-red-600 text-white px-6 py-3 rounded-full text-xl sm:text-2xl font-extrabold shadow-lg animate-pulse">
              -{{ product.discount_percent }}%
            </div>
            {% else %}
            <span class="text-5xl sm:text-6xl lg:text-7xl font-extrabold text-emerald-600">${{ product.price|floatformat:2 }}</span>
            {% endif %}
          </div>

          <!-- Stock holati ‚Äî chiroyli badge -->
          <div class="mb-10">
            {% if product.stock > 0 %}
              {% if product.stock <= 5 %}
              <span class="inline-block bg-orange-100 text-orange-800 px-6 py-3 rounded-full text-lg sm:text-xl font-bold">
                Faqat {{ product.stock }} ta qoldi! ‚ö°
              </span>
              {% else %}
              <span class="inline-block bg-emerald-100 text-emerald-800 px-6 py-3 rounded-full text-lg sm:text-xl font-bold">
                Qolgan: {{ product.stock }} ta ‚úì
              </span>
              {% endif %}
            {% else %}
            <span class="inline-block bg-red-100 text-red-800 px-6 py-3 rounded-full text-lg sm:text-xl font-bold">
              Tugagan üòî
            </span>
            {% endif %}
          </div>

          <!-- Tavsif -->
          <div class="mb-12">
            <h3 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-4">Tavsif</h3>
            <p class="text-base sm:text-lg text-gray-700 leading-relaxed whitespace-pre-line">
              {{ product.description|default:"Tavsif mavjud emas" }}
            </p>
          </div>
        </div>

        <!-- Tugmalar ‚Äî premium va katta -->
        <div class="space-y-6">
          {% if user.is_authenticated %}
            {% if product.stock > 0 %}
            <form method="post" class="w-full">
              {% csrf_token %}
              <button type="submit"
                      class="w-full bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-extrabold text-2xl sm:text-3xl lg:text-4xl py-6 sm:py-7 rounded-3xl shadow-2xl transition-all duration-300 transform hover:scale-105 active:scale-95">
                Sotib olish üõí
              </button>
            </form>
            {% else %}
            <button disabled class="w-full bg-gray-400 text-gray-200 font-extrabold text-2xl sm:text-3xl py-6 rounded-3xl cursor-not-allowed">
              Tugagan
            </button>
            {% endif %}
          {% else %}
          <a href="{% url 'login' %}"
             class="block text-center w-full bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-extrabold text-2xl sm:text-3xl lg:text-4xl py-6 sm:py-7 rounded-3xl shadow-2xl transition-all duration-300 transform hover:scale-105">
            Sotib olish uchun kirish
          </a>
          {% endif %}

          <a href="{% url 'product_list' %}"
             class="block text-center text-emerald-600 hover:text-emerald-700 font-semibold text-lg sm:text-xl mt-6">
            ‚Üê Barcha mahsulotlarga qaytish
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}