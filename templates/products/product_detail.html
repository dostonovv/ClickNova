{% extends "core/base.html" %}
{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-12">
  <div class="grid lg:grid-cols-2 gap-12">
    <!-- Gallery — Chap taraf -->
    <div class="order-2 lg:order-1">
      <!-- Asosiy rasm -->
      <div class="mb-6 rounded-3xl shadow-2xl overflow-hidden bg-gray-100">
        <img id="mainImage"
             src="{% if product.images.all %}
                    {% with product.images.all|dictsort:'is_main'|last as main_img %}
                      {% if main_img.is_main %}{{ main_img.image.url }}{% else %}{{ product.images.first.image.url }}{% endif %}
                    {% endwith %}
                  {% else %}
                    https://via.placeholder.com/800x800?text=Rasm+yo'q
                  {% endif %}"
             alt="{{ product.name }}"
             class="w-full h-full object-cover transition-transform duration-500 hover:scale-105 cursor-zoom-in">
      </div>

      <!-- Kichik rasmlar (thumbnail) -->
      {% if product.images.count > 1 %}
      <div class="grid grid-cols-4 sm:grid-cols-5 gap-4">
        {% for img in product.images.all %}
        <div class="rounded-xl shadow-lg overflow-hidden cursor-pointer border-4 transition-all {% if img.is_main %}border-emerald-600{% else %}border-transparent hover:border-emerald-400{% endif %}"
             onclick="document.getElementById('mainImage').src='{{ img.image.url }}'">
          <img src="{{ img.image.url }}"
               alt="{{ img.alt_text|default:product.name }}"
               class="w-full h-32 object-cover">
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- Ma’lumotlar — O‘ng taraf -->
    <div class="order-1 lg:order-2 flex flex-col justify-between">
      <div>
        {% if product.category %}
        <a href="#" class="inline-block bg-emerald-100 text-emerald-800 px-4 py-2 rounded-full text-sm font-medium mb-4 hover:bg-emerald-200 transition">
          {{ product.category.name }}
        </a>
        {% endif %}

        <h1 class="text-5xl font-bold text-gray-800 mb-6">{{ product.name }}</h1>

        <!-- Narx — Chegirma bilan -->
        <div class="mb-8 flex items-end gap-4">
          {% if product.discount_percent > 0 %}
          <span class="text-3xl text-gray-500 line-through">${{ product.price|floatformat:2 }}</span>
          <span class="text-6xl font-bold text-emerald-600">${{ product.get_discounted_price|floatformat:2 }}</span>
          <span class="bg-red-600 text-white px-5 py-2 rounded-full text-xl font-bold">
            -{{ product.discount_percent }}%
          </span>
          {% else %}
          <span class="text-6xl font-bold text-emerald-600">${{ product.price|floatformat:2 }}</span>
          {% endif %}
        </div>

        <!-- Stock holati -->
        <div class="mb-8">
          {% if product.stock > 0 %}
          <p class="text-xl text-green-600 font-medium">
            Qolgan: <strong>{{ product.stock }} ta</strong>
          </p>
          {% else %}
          <p class="text-xl text-red-600 font-medium">Tugagan</p>
          {% endif %}
        </div>

        <!-- Tavsif -->
        <div class="mb-10">
          <h3 class="text-2xl font-bold text-gray-800 mb-4">Tavsif</h3>
          <p class="text-gray-700 text-lg leading-relaxed whitespace-pre-line">
            {{ product.description|default:"Tavsif mavjud emas" }}
          </p>
        </div>
      </div>

      <!-- Sotib olish tugmasi -->
      <div>
        {% if user.is_authenticated %}
          {% if product.stock > 0 %}
          <form method="post" class="w-full">
            {% csrf_token %}
            <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-3xl py-6 rounded-3xl shadow-2xl transition transform hover:scale-105 active:scale-95">
              Sotib olish
            </button>
          </form>
          {% else %}
          <button disabled class="w-full bg-gray-400 text-gray-200 font-bold text-3xl py-6 rounded-3xl cursor-not-allowed">
            Tugagan
          </button>
          {% endif %}
        {% else %}
          <a href="{% url 'login' %}" class="block text-center w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold text-3xl py-6 rounded-3xl shadow-2xl transition transform hover:scale-105">
            Sotib olish uchun kirish
          </a>
        {% endif %}

        <a href="{% url 'product_list' %}" class="block text-center mt-8 text-emerald-600 hover:underline text-xl font-medium">
          ← Barcha mahsulotlarga qaytish
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
