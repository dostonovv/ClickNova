{% extends "core/base.html" %}
{% block title %}Buyurtma #{{ order.id }} — Support{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
  <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-emerald-600 text-center mb-10 sm:mb-12">
    Buyurtma #{{ order.id }} — Support Panel
  </h1>

  <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
    <!-- Buyurtma ma’lumotlari -->
    <div class="p-6 sm:p-8 lg:p-10">
      <!-- Foydalanuvchi ma’lumotlari (mobil da yuqorida) -->
      <div class="bg-emerald-50 rounded-2xl p-6 sm:p-8 mb-10">
        <h3 class="text-2xl sm:text-3xl font-bold text-emerald-800 mb-6">Buyurtmachi ma’lumotlari</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 text-lg sm:text-xl">
          <div>
            <p class="text-gray-700"><strong>Username:</strong> <span class="font-bold text-emerald-700">@{{ order.user.username }}</span></p>
            {% if order.user.full_name %}
            <p class="text-gray-700 mt-3"><strong>Ism-familiya:</strong> <span class="font-medium">{{ order.user.full_name }}</span></p>
            {% endif %}
          </div>
          <div>
            <p class="text-gray-700"><strong>Telefon:</strong>
              <span class="font-bold text-emerald-600 text-xl">
                {{ order.user.phone_number|default:"Belgilanmagan" }}
              </span>
            </p>
            <p class="text-gray-600 mt-3"><strong>Buyurtma vaqti:</strong> {{ order.purchased_at|date:"d M Y, H:i" }}</p>
          </div>
        </div>
      </div>

      <!-- Mahsulot rasmi va nomi -->
      <div class="grid lg:grid-cols-2 gap-8 lg:gap-12">
        <!-- Gallery — Chap taraf (mobil da yuqorida) -->
        <div class="order-2 lg:order-1">
          <!-- Asosiy rasm -->
          <div class="mb-6 rounded-3xl shadow-xl overflow-hidden bg-gray-50">
            <img id="mainSupportImage"
                 src="{% if order.product.images.all %}
                        {% with order.product.images.filter(is_main=True).first|default:order.product.images.first as main_img %}
                          {{ main_img.image.url }}
                        {% endwith %}
                      {% else %}
                        https://via.placeholder.com/1000x1000?text=No+Image
                      {% endif %}"
                 alt="{{ order.product.name }}"
                 class="w-full h-80 sm:h-96 lg:h-full object-cover transition-all duration-500 hover:scale-105">
          </div>

          <!-- Thumbnail rasmlar -->
          {% if order.product.images.count > 1 %}
          <div class="grid grid-cols-3 sm:grid-cols-4 gap-3 sm:gap-4">
            {% for img in order.product.images.all %}
            <div class="rounded-xl shadow-lg overflow-hidden cursor-pointer border-4 transition-all {% if img.is_main %}border-emerald-600 ring-4 ring-emerald-300{% else %}border-gray-200 hover:border-emerald-400{% endif %}"
                 onclick="document.getElementById('mainSupportImage').src='{{ img.image.url }}'">
              <img src="{{ img.image.url }}" alt="{{ order.product.name }}" class="w-full h-24 sm:h-32 object-cover">
            </div>
            {% endfor %}
          </div>
          {% endif %}
        </div>

        <!-- Ma’lumotlar — O‘ng taraf (mobil da pastda) -->
        <div class="order-1 lg:order-2">
          <h2 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-gray-900 mb-6">
            {{ order.product.name }}
          </h2>

          <p class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-emerald-600 mb-8">
            ${{ order.total_price|floatformat:2 }}
          </p>

          <p class="text-lg sm:text-xl text-gray-700 mb-6">
            Joriy yetkazib berish muddati: <strong>{{ order.product.delivery_days }} kun</strong>
          </p>
        </div>
      </div>
    </div>

    <!-- Yetkazib berish sozlamalari -->
    <div class="bg-emerald-50 p-6 sm:p-8 lg:p-10">
      <h3 class="text-2xl sm:text-3xl lg:text-4xl font-bold text-emerald-800 mb-8 text-center lg:text-left">
        Yetkazib berish sozlamalari
      </h3>

      <form method="post" class="space-y-8">
        {% csrf_token %}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- Yetkazib berish muddati -->
          <div>
            <label for="delivery_days" class="block text-lg sm:text-xl font-semibold text-gray-700 mb-3">
              Yetkazib berish muddati (kun)
            </label>
            <input type="number"
                   name="delivery_days"
                   id="delivery_days"
                   value="{{ order.product.delivery_days }}"
                   min="1"
                   max="30"
                   required
                   class="w-full px-6 py-4 text-lg sm:text-xl border-2 border-gray-300 rounded-2xl focus:ring-4 focus:ring-emerald-300 focus:border-emerald-600 transition-all">
          </div>

          <!-- Status -->
          <div>
            <label for="status" class="block text-lg sm:text-xl font-semibold text-gray-700 mb-3">
              Buyurtma holati
            </label>
            <select name="status" id="status" class="w-full px-6 py-4 text-lg sm:text-xl border-2 border-gray-300 rounded-2xl focus:ring-4 focus:ring-emerald-300 focus:border-emerald-600 transition-all">
              <option value="accepted" {% if order.status == 'accepted' %}selected{% endif %}>Buyurtma qabul qilindi</option>
              <option value="shipping" {% if order.status == 'shipping' %}selected{% endif %}>Yetkazilmoqda</option>
              <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Yetkazib berildi</option>
            </select>
          </div>
        </div>

        <div class="text-center mt-10">
          <button type="submit"
                  class="bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800 text-white font-extrabold text-xl sm:text-2xl lg:text-3xl py-5 sm:py-6 px-16 sm:px-20 rounded-2xl shadow-2xl transition-all duration-300 transform hover:scale-105 active:scale-95">
            Saqlash
          </button>
        </div>
      </form>

      <div class="mt-10 p-6 bg-white rounded-2xl border-2 border-emerald-200 text-center">
        <p class="text-base sm:text-lg text-gray-700">
          O‘zgartirilgan ma’lumotlar foydalanuvchiga <strong>darrov</strong> ko‘rinadi.
        </p>
      </div>
    </div>

    <!-- Orqaga qaytish -->
    <div class="text-center py-8">
      <a href="{% url 'support_dashboard' %}"
         class="inline-flex items-center gap-3 text-emerald-600 hover:text-emerald-700 font-semibold text-lg sm:text-xl transition">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        Barcha buyurtmalarga qaytish
      </a>
    </div>
  </div>
</div>
{% endblock %}